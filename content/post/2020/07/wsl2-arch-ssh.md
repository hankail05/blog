+++
title = "wsl2 arch로 ssh 구축하는 삽질"
date = 2020-07-08T13:20:00
tags = ["wsl", "arch-linux", "ssh"]
draft = false
+++

본인은 따끈따끈한 이병이다. 사지방에서 함부로 포트 뚫으면 큰일 나지만, 모바일로 ssh 접속하면 문제없으니 모바일 환경에서 코딩과 블로그 포스팅을 하려고 계획했다..

<!--more-->

집에 있는 데스크탑을 가족끼리 쓰다보니 윈도우를 밀 수 없다. 따라서 wsl를 이용해야되는데, wsl1 내 아치 리눅스에 [안되는 게 많아서](<https://github.com/yuk7/ArchWSL/wiki/Known-issues>) wsl2를 사용해야한다. 마침 2004버전에 정식 릴리즈된다하니, 군대가기(5/12) 전 까지 나오겠거니 하고 기다렸다.

그리고 안 나왔다.

그냥 수학이나 할까 생각하던 와중에, 갑자기 코로나로 인해 중대 전 인원이 휴가를 무조건 나가야한다는 지침이 내려왔다. 그래서 군대 간 지 2달도 채 안되어 집에 돌아와 못 다한 작업을 하게 되었다.

일단 wsl에 아치를 올려야겠지. wsl2 활성화 방법은 다른 블로그에 잘 있더라. 다만, 아치 리눅스는 스토어에 없어 [깃헙](<https://github.com/yuk7/ArchWSL>)에서 다운 받아야 했다. OS설치는 자동화 되어 있어, 내가 따로 해줘야 할 것은 패키지 받고 설정파일 클론하는 정도였다. `fakeroot` 는 wsl2에서 잘 되니까 `fakeroot-tcp` 를 지워주고. 이제 ssh만 연결하면 끝난다.

22번 포트는 wsl이 선점하고 있으니, 적당히 다른 포트로 바꿔서 연결을 시도했다. localhost에서 작동 확인하고 포트포워딩 하고 드디어 연결을 하나 싶었는데, 안된다. 서버가 뭘 받는 기미도 없길래 ip를 잘못 입력했나 싶어서 `ifconfig` 를 쳐봤더니, ip가 오타치곤 너무 다르다. 그렇다. 윈도우와 wsl의 ip가 서로 다르다. wsl2에서 가상화를 도입했기 때문인지, 가상 ip를 따로 쓰는 것이었다. 내부 ip에서 wsl로 포트포워딩하면 되겠지만, 이놈의 ip가 부팅 때 마다 바뀌더라.

다행히, [해결법은 이미 나와있다.](<https://github.com/microsoft/WSL/issues/4150#issuecomment-504209723>) `$ports` 의 값을 ssh에 할당한 포트로 설정한 후 파워셸 스크립트로 저장하면 된다고 한다. 켤 때 마다 실행해줘야 하는 거야 배치 스크립트 짜서 시작 프로그램 폴더에 넣으면 그만이고.

삽질을 열심히 한 끝에 마침내 원격코딩을 할 수 있게 되었다. 모바일로 이맥스를 쓸 생각하니 벌써부터 기대가 된다.
